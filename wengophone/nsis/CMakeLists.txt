# Bugfix, spaces don't work with install target
string(REPLACE "CMAKEBUGWITHSPACES" " " BUILD_DIR ${BUILD_DIR})
string(REPLACE "CMAKEBUGWITHSPACES" " " SOURCE_DIR ${SOURCE_DIR})


set(NSIS_PROGRAM
	"C:/Program Files/NSIS/makensis.exe"
)

set(INSTALLER_NAME
	WengoPhone-setup
)

set(NSIS_ARGS
	/DPRODUCT_NAME=${APPLICATION_NAME}
	/DPRODUCT_VERSION=${APPLICATION_VERSION}
	/DBUILD_DIR=${BUILD_DIR}
	/DQTDIR=$ENV{QTDIR}
)

if (BUILD_TYPE MATCHES Debug)
	set(INSTALLER_NAME ${INSTALLER_NAME}-debug)

	set(NSIS_ARGS
		${NSIS_ARGS}
		/DDEBUG
	)
else (BUILD_TYPE MATCHES Debug)
	set(INSTALLER_NAME ${INSTALLER_NAME}-release)
endif (BUILD_TYPE MATCHES Debug)

if (INSTALLER_WITH_PDB)
	set(INSTALLER_NAME ${INSTALLER_NAME}-pdb)

	set(NSIS_ARGS
		${NSIS_ARGS}
		/DWITH_PDB
	)
endif (INSTALLER_WITH_PDB)

set(INSTALLER_NAME ${INSTALLER_NAME}-${SVN_REVISION}.exe)

set(NSIS_ARGS
	${NSIS_ARGS}
	/DINSTALLER_NAME=${INSTALLER_NAME}
)

execute_process(
	COMMAND ${NSIS_PROGRAM} ${NSIS_ARGS} ${SOURCE_DIR}/wengophone/nsis/installer.nsi
	WORKING_DIRECTORY ${BUILD_DIR}
)
