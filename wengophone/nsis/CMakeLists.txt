set(NSIS_PROGRAM
	"C:/Program Files/NSIS/makensis.exe"
)

set(INSTALLER_NAME
	WengoPhone-setup
)

set(NSIS_ARGS
	/DPRODUCT_NAME=${APPLICATION_NAME}
	/DPRODUCT_VERSION=${APPLICATION_VERSION}
	/DBUILD_DIR=${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE}
	/DQTDIR=$ENV{QTDIR}
)

if (CMAKE_BUILD_TYPE MATCHES Debug)
	set(INSTALLER_NAME ${INSTALLER_NAME}-debug)

	set(NSIS_ARGS
		${NSIS_ARGS}
		/DDEBUG
	)
else (CMAKE_BUILD_TYPE MATCHES Debug)
	set(INSTALLER_NAME ${INSTALLER_NAME}-release)
endif (CMAKE_BUILD_TYPE MATCHES Debug)

if (WITH_PDB)
	set(INSTALLER_NAME ${INSTALLER_NAME}-pdb)

	set(NSIS_ARGS
		${NSIS_ARGS}
		/DWITH_PDB
	)
endif (WITH_PDB)

set(INSTALLER_NAME ${INSTALLER_NAME}-${SVN_REVISION}.exe)

message(${INSTALLER_NAME})
message(${NSIS_ARGS})

set(NSIS_ARGS
	${NSIS_ARGS}
	/DINSTALLER_NAME=${INSTALLER_NAME}
)

execute_process(
	COMMAND ${NSIS_PROGRAM} ${NSIS_ARGS} ${CMAKE_CURRENT_SOURCE_DIR}/installer.nsi
)
