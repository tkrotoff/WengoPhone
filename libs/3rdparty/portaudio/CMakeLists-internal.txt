ow_create_shared_library(portaudio)

ow_add_public_include_dirs(
	${CMAKE_CURRENT_SOURCE_DIR}/pa_common
)

ow_add_private_definitions(
	-DPA_NO_ASIO
	-DPA_NO_WDMKS
	-DSIZEOF_SHORT=2
	-DSIZEOF_INT=4
	-DSIZEOF_LONG=4
)

ow_add_sources(
	pa_common/pa_allocation.c
	pa_common/pa_converters.c
	pa_common/pa_cpuload.c
	pa_common/pa_dither.c
	pa_common/pa_front.c
	pa_common/pa_process.c
	pa_common/pa_skeleton.c
	pa_common/pa_stream.c
	pa_common/pa_trace.c
)

if (WIN32)
	ow_add_sources(
		pa_win/pa_win_util.c
		pa_win/pa_win_hostapis.c
		pa_win/pa_x86_plain_converters.c
		portaudio.def
	)

	ow_add_private_definitions(
		-DPA_LITTLE_ENDIAN
		-DPA_NO_ASIO
		-DPA_NO_WDMKS
	)

	if (PORTAUDIO_DIRECTSOUND_SUPPORT)
		ow_add_sources(
			pa_win_ds/dsound_wrapper.c
			pa_win_ds/pa_win_ds.c
		)
		ow_add_private_definitions(
			-DPA_NO_WMME
		)
	else (PORTAUDIO_DIRECTSOUND_SUPPORT)
		ow_add_sources(
			pa_win_wmme/pa_win_wmme.c
		)
		ow_add_private_definitions(
			-DPA_NO_DS
		)
	endif (PORTAUDIO_DIRECTSOUND_SUPPORT)
endif (WIN32)

if (UNIX)
	ow_add_sources(
		pa_unix/pa_unix_util.c
		pa_unix/pa_unix_hostapis.c
	)
	ow_add_private_definitions(
		-DPA_LITTLE_ENDIAN
		-DHAVE_LIBPTHREAD
	)
	ow_add_private_libraries(
		pthread
		m
	)

	if (PORTAUDIO_OSS_SUPPORT)
		ow_add_sources(
			pa_unix_oss/pa_unix_oss.c
		)
		ow_add_private_definitions(
			-DPA_USE_OSS
		)
	else (PORTAUDIO_OSS_SUPPORT)

	if (PORTAUDIO_ALSA_SUPPORT)
		ow_add_sources(
			pa_unix_oss/pa_unix_oss.c
		)
		ow_add_private_definitions(
			-DPA_USE_ALSA
		)
	else (PORTAUDIO_ALSA_SUPPORT)
		message(FATAL_ERROR "PortAudio backend error: you have to choose between ALSA and OSS support")
	endif (PORTAUDIO_ALSA_SUPPORT)

	endif (PORTAUDIO_OSS_SUPPORT)
endif (UNIX)

if (APPLE)
	ow_add_sources(
		pa_mac/pa_mac_hostapis.c
		pa_unix/pa_unix_util.c
		pa_mac_core/pa_mac_core.c
	)
	ow_add_private_definitions(
		-DPA_BIG_ENDIAN
		-DWORDS_BIGENDIAN
		-DPA_USE_COREAUDIO
	)
endif (APPLE)

ow_create_binary()
